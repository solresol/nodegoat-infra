<VirtualHost *:80>
    ServerName ${NODEGOAT_DOMAIN}
    ServerAlias *.${NODEGOAT_DOMAIN} ${NODEGOAT_CMS_DOMAIN}

    DocumentRoot /var/1100CC/APP

    # 1100CC RewriteMap for hostname to site mapping
    # This is required by the 1100CC framework's .htaccess routing
    RewriteMap alias "txt:/var/1100CC/APP/alias"

    <Directory /var/1100CC/APP>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Deny access to settings directory
    <DirectoryMatch "^/var/1100CC/APP/SETTINGS/">
        Require all denied
    </DirectoryMatch>

    # Allow access to storage for uploaded files
    <Directory /var/1100CC/APP/STORAGE>
        Options -Indexes
        Require all granted
    </Directory>

    # Security headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"

    # Enable compression
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript application/json
    </IfModule>

    # Logging
    LogLevel warn
    ErrorLog ${APACHE_LOG_DIR}/nodegoat-error.log
    CustomLog ${APACHE_LOG_DIR}/nodegoat-access.log combined

    # PHP settings via Apache
    <FilesMatch \.php$>
        SetHandler application/x-httpd-php
    </FilesMatch>
</VirtualHost>
